{% extends 'main/base.html' %}
{% load static %}

{% block content %}
    <nav class="breadcrumb-container" aria-label="breadcrumb">
        <ol class="breadcrumb-list">
            <li class="breadcrumb-item">
                <a href="{% url 'index' %}" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">{{ property.name }}</li>
        </ol>
    </nav>


    <section class="objects-section">
        <div class="single-property-container">
            <div class="single-property-gallery">
                <!-- –ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ -->
                {% if photos %}
                    <div class="gallery-main-photo" id="main-photo-block">
                        <img id="mainPhoto" src="{{ photos.0.photo.url }}" alt="{{ photos.0.alt_text }}"
                             onclick="openGalleryPopup(0)">
                    </div>
                    <div class="gallery-thumbnails" id="gallery-thumbnails">
                        {% for photo in photos %}
                            <img src="{{ photo.photo.url }}" alt="{{ photo.alt_text }}" class="thumbnail"
                                 onclick="selectThumbnail({{ forloop.counter0 }})">
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="single-property-info">
                <h1 class="single-page-title">{{ property.name }}</h1>
                <p><b>–ê–¥—Ä–µ—Å:</b> {{ property.address }}</p>
                <p><b>–¢–∏–ø:</b>
                    {% if property.is_active_apartment %} –ö–≤–∞—Ä—Ç–∏—Ä–∞
                    {% elif property.is_active_house %} –î–æ–º
                    {% elif property.is_active_country_house %} –î–∞—á–∞
                    {% elif property.is_active_new %} –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞
                    {% else %} –î—Ä—É–≥–æ–µ
                    {% endif %}
                </p>
                <p><b>–≠—Ç–∞–∂:</b> {{ property.floor }}</p>
                <p><b>–ö–æ–º–Ω–∞—Ç:</b> {{ property.many_rooms }}</p>
                <p><b>–ü–ª–æ—â–∞–¥—å:</b> {{ property.area }} –º¬≤
                    {% if property.area_ga %} ({{ property.area_ga }} —Å–æ—Ç./–≥–∞) {% endif %}
                </p>
                <p><b>–¶–µ–Ω–∞ –∞—Ä–µ–Ω–¥—ã:</b> <span
                        class="property-price">{{ property.price }} {{ property.currency }}</span>
                </p>
                <button class="callback-btn" onclick="showCallbackModal()">üîî –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫</button>
            </div>
        </div>
        <div class="single-property-desc">
            <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
            <p>{{ property.description }}</p>
        </div>
    </section>

    <!-- Popup for photo gallery -->
    <div class="photo-popup" id="photoPopup" style="display:none;">
        <span class="popup-close" onclick="closeGalleryPopup()">&times;</span>
        <img class="popup-img" id="popupImg" src="" alt="">
        <div class="popup-arrows">
            <span class="popup-arrow left" onclick="prevPhoto()">&lt;</span>
            <span class="popup-arrow right" onclick="nextPhoto()">&gt;</span>
        </div>
    </div>

    <script>
        // –ú–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ
        const photos = [
            {% for photo in photos %}
                "{{ photo.photo.url }}"{% if not forloop.last %},{% endif %}
            {% endfor %}
        ];
        let currentPhotoIdx = 0;

        // –ü–æ–∫–∞–∑ –º–∏–Ω–∏–∞—Ç—é—Ä—ã
        function selectThumbnail(idx) {
            document.getElementById('mainPhoto').src = photos[idx];
            currentPhotoIdx = idx;
        }

        // –ì–∞–ª–µ—Ä–µ—è popup
        function openGalleryPopup(idx) {
            document.getElementById('photoPopup').style.display = 'flex';
            document.getElementById('popupImg').src = photos[idx];
            currentPhotoIdx = idx;
        }

        function closeGalleryPopup() {
            document.getElementById('photoPopup').style.display = 'none';
        }

        function prevPhoto() {
            currentPhotoIdx = (currentPhotoIdx - 1 + photos.length) % photos.length;
            document.getElementById('popupImg').src = photos[currentPhotoIdx];
        }

        function nextPhoto() {
            currentPhotoIdx = (currentPhotoIdx + 1) % photos.length;
            document.getElementById('popupImg').src = photos[currentPhotoIdx];
        }

        // –ö–ª–∏–∫ –ø–æ –º–∏–Ω–∏–∞—Ç—é—Ä–µ –≤–Ω—É—Ç—Ä–∏ popup
        document.getElementById('popupImg')?.addEventListener('click', nextPhoto);

        // –ö–æ–ª–±–µ–∫ –º–æ–¥–∞–ª–∫–∞ (–ø—Ä–æ—Å—Ç–æ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏)
        function showCallbackModal() {
            alert("–§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å");
        }
    </script>
{% endblock %}
